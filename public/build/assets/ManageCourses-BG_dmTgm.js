import{K as Se,r as i,m as we,j as e,L as Ae,S as p,t as B}from"./app-BL0KWvuE.js";import{A as ke}from"./app-layout-C9W-Z8tt.js";import{C as S,a as w,b as A,c as k,B as O}from"./badge-DX-hSzwJ.js";import{B as n}from"./button-CjHP5RnJ.js";import{I}from"./input-DaAHyLeW.js";import{L as u}from"./label-Dr1cfO0H.js";import{T as J}from"./textarea-BWnTbQcQ.js";import{S as V,a as z,b as P,c as Y,d as f}from"./select-Y-lX9e8p.js";import{T as Ie,a as Re,b as H,c as _}from"./tabs-DSVoaUKn.js";import{A as Me,a as Te,b as Ee,c as De}from"./alert-dialog-ohILZYad.js";import{P as W}from"./placeholder-pattern-DDg-imHs.js";import{D as Z}from"./delete-modal-BSpFg05r.js";import{S as Le}from"./search-BVSg3_k5.js";import{P as Q}from"./plus-CigWFzLG.js";import{S as $e}from"./square-pen-CwhG7wQ1.js";import{T as Fe}from"./trash-2-D2gvyVBC.js";import{B as Be}from"./book-open-DgnQBgSR.js";import{c as ee}from"./graduation-cap-D_NDlXqB.js";import{X as Oe}from"./x-J_75UvRD.js";import{B as Ve}from"./book-CIUT5YPZ.js";import"./user-menu-content-mFISpfd6.js";import"./index-CJPvCRj7.js";import"./index-hOn5HVUv.js";import"./app-logo-icon-erXsJOKm.js";import"./users-DlRXdw9-.js";import"./mail-C4_eHR4b.js";import"./index-G8YvO4IO.js";import"./check-D8S4E2On.js";import"./unlink-jbbLCgI1.js";import"./triangle-alert-BWkoumGQ.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M5 12h14",key:"1ays0h"}]],Pe=ee("Minus",ze);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],He=ee("Save",Ye),_e=[{title:"Manage Courses",href:"admin/manageCourses"}];function bs({courses:N,allSubjects:D}){const{auth:y}=Se().props,[se,C]=i.useState("view-courses"),[d,L]=i.useState(null),[Qe,qe]=i.useState(null),[te,q]=i.useState(!1),[ae,K]=i.useState(!1),[b,re]=i.useState("all"),[h,ie]=i.useState(""),[a,R]=i.useState({toAdd:[],toRemove:[]}),[$,M]=i.useState(!1),{data:j,setData:F,post:le,processing:T,errors:v,reset:ce}=we({code:"",name:"",description:""}),U=i.useMemo(()=>N.filter(s=>{const r=b==="all"||(b==="active"?s.isActive===1:s.isActive===0),l=h===""||s.name.toLowerCase().includes(h.toLowerCase())||s.code.toLowerCase().includes(h.toLowerCase())||s.description.toLowerCase().includes(h.toLowerCase());return r&&l}),[N,b,h]),X=()=>{if(!d)return[];const s=N.find(x=>x.id===d);let l=((s==null?void 0:s.subjects)||[]).filter(x=>!a.toRemove.includes(x.pivotId));const c=D.filter(x=>a.toAdd.includes(x.id)).map(x=>({...x,pivotId:0}));return l=[...l,...c],l},G=()=>{var l;if(!d)return[];const s=N.find(c=>c.id===d);if(!s)return D;const r=((l=s.subjects)==null?void 0:l.map(c=>c.id))||[];return D.filter(c=>!r.includes(c.id)&&!a.toAdd.includes(c.id)&&!a.toRemove.includes(c.id))},ne=s=>{R(r=>({...r,toAdd:[...r.toAdd,s]})),M(!0)},[o,de]=i.useState(null),[oe,me]=i.useState(0),ue=async s=>{K(!0),de(s),me(s.pivotId),console.log(s.pivotId),p.post(route("admin.addActivity"),{type:"remove",user:y.user.name,action:"Remove a subject",details:`${o==null?void 0:o.title}`},{})},he=()=>{if(!d||a.toAdd.length===0&&a.toRemove.length===0){console.log("No course selected or no changes to save");return}const s={course_id:d,toAdd:a.toAdd,toRemove:a.toRemove};p.post(route("admin.assignSubjects"),s,{onSuccess:()=>{p.post(route("admin.addActivity"),{type:"assign",user:y.user.name,action:"Assign subjects",details:`${a==null?void 0:a.toAdd}`},{}),R({toAdd:[],toRemove:[]}),M(!1),console.log("Curriculum updated successfully!"),B.success("Curriculum updated successfully!")},onError:r=>{console.error("Error saving curriculum changes:",r)}})},xe=()=>{R({toAdd:[],toRemove:[]}),M(!1)},pe=s=>{$?confirm("You have unsaved changes. Do you want to discard them?")&&(R({toAdd:[],toRemove:[]}),M(!1),L(Number.parseInt(s))):L(Number.parseInt(s))},je=async s=>{s.preventDefault(),le(route("admin.addCourse"),{onSuccess:()=>{p.post(route("admin.addActivity"),{type:"create",user:y.user.name,action:"Create new course",details:`${j==null?void 0:j.name}`},{}),ce(),B.success("New course has been added.")},onError:r=>{console.error("Error occured",r)}})},[m,ve]=i.useState(null),[ge,fe]=i.useState(0),Ne=async s=>{q(!0),ve(s),fe(s.id),p.post(route("admin.addActivity"),{type:"delete",user:y.user.name,action:"Delete a course",details:`${s==null?void 0:s.name}`},{}),console.log(s)},[t,g]=i.useState(null),[ye,E]=i.useState(!1),Ce=async s=>{g(s),E(!0)},be=async s=>{p.put(route("admin.updateCourse",s),{code:t==null?void 0:t.code,name:t==null?void 0:t.name,description:t==null?void 0:t.description,isActive:t==null?void 0:t.isActive},{onSuccess:()=>{g(null),B("Edit successfully"),E(!1),p.post(route("admin.addActivity"),{type:"edit",user:y.user.name,action:"Updated course",details:`${t==null?void 0:t.name} modified`},{})},onError:r=>{console.error("Error on editing course",r)}})};return e.jsxs(ke,{breadcrumbs:_e,children:[e.jsx(Ae,{title:"Manage Students"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl overflow-x-auto p-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Courses & Curriculum"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage degree programs and their curriculum. Create courses first, then add subjects to build the curriculum."})]}),e.jsxs(Ie,{value:se,onValueChange:C,className:"space-y-4",children:[e.jsxs(Re,{className:"grid w-full grid-cols-3 ",children:[e.jsx(H,{value:"view-courses",className:"cursor-pointer",children:"View Courses"}),e.jsx(H,{value:"add-course",className:"cursor-pointer",children:"Add New Course"}),e.jsx(H,{value:"manage-curriculum",className:"cursor-pointer",children:"Manage Curriculum"})]}),e.jsx(_,{value:"view-courses",className:"space-y-4",children:e.jsxs(S,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"All Degree Programs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(I,{placeholder:"Search courses...",className:"pl-8 w-64",value:h,onChange:s=>ie(s.target.value)})]}),e.jsxs(V,{value:b,onValueChange:s=>re(s),children:[e.jsx(z,{className:"w-[120px]",children:e.jsx(P,{placeholder:"Filter by status"})}),e.jsxs(Y,{children:[e.jsx(f,{value:"all",children:"All Status"}),e.jsx(f,{value:"active",children:"Active"}),e.jsx(f,{value:"inactive",children:"Inactive"})]})]}),e.jsxs(n,{onClick:()=>C("add-course"),children:[e.jsx(Q,{className:"h-4 w-4 mr-2 cursor-pointer"}),"Add Course"]})]})]})}),e.jsx(k,{children:U.length>0?e.jsx("div",{className:"space-y-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:U.map(s=>{var r,l;return e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx(O,{variant:"outline",children:s.code}),e.jsxs(O,{variant:"secondary",children:[((r=s.subjects)==null?void 0:r.length)||0," subjects"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:s.isActive===1?"default":"secondary",children:s.isActive===1?"active":"inactive"}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>Ce(s),className:" cursor-pointer",children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx(n,{variant:"outline",size:"sm",className:" cursor-pointer",onClick:()=>Ne(s),children:e.jsx(Fe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2",children:["Curriculum (",((l=s.subjects)==null?void 0:l.length)||0," subjects)"]}),s.subjects&&s.subjects.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:s.subjects.slice(0,4).map(c=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-secondary rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:c.code}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:c.title})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Y",c.yearLevel,"S",c.semester]})]},c.code))}),s.subjects.length>4&&e.jsxs(n,{variant:"ghost",size:"sm",className:"mt-2 cursor-pointer",onClick:()=>{L(s.id),C("manage-curriculum")},children:["View all ",s.subjects.length," subjects →"]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No subjects assigned yet"})]})]})})},s.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(W,{className:"h-24 w-24 text-muted-foreground"}),e.jsxs("div",{className:"text-center space-y-2 flex flex-col items-center",children:[e.jsx(Be,{className:"h-8 w-8 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-medium",children:"No courses found"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h||b!=="all"?"Try adjusting your search or filter criteria":"You haven't added any courses yet"})]}),e.jsxs(n,{onClick:()=>C("add-course"),className:" cursor-pointer",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Add New Course"]})]})})]})}),e.jsx(_,{value:"add-course",className:"space-y-4",children:e.jsxs(S,{children:[e.jsx(w,{children:e.jsx(A,{children:"Add New Course Program"})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"code",children:"Course Code"}),e.jsx(I,{id:"code",value:j.code,onChange:s=>F("code",s.target.value),placeholder:"e.g. BSIS, BSCS"}),v.code&&e.jsx("p",{className:"text-sm text-destructive",children:v.code})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"Course Name"}),e.jsx(I,{id:"name",value:j.name,onChange:s=>F("name",s.target.value),placeholder:"e.g. Bachelor of Science in Information Systems"}),v.name&&e.jsx("p",{className:"text-sm text-destructive",children:v.name})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"description",children:"Description"}),e.jsx(J,{id:"description",value:j.description,onChange:s=>F("description",s.target.value),placeholder:"Enter course description",rows:3}),v.description&&e.jsx("p",{className:"text-sm text-destructive",children:v.description})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(n,{onClick:je,disabled:T,className:" cursor-pointer",children:T?"Adding...":"Add Course"}),e.jsx(n,{variant:"outline",onClick:()=>C("view-courses"),className:" cursor-pointer",children:"Cancel"})]})]})})]})}),e.jsx(_,{value:"manage-curriculum",className:"space-y-4",children:e.jsxs(S,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{children:"Manage Course Curriculum"}),$&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{onClick:he,disabled:T||a.toAdd.length===0&&a.toRemove.length===0,size:"sm",className:" cursor-pointer",children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),T?"Saving...":"Save Changes"]}),e.jsxs(n,{onClick:xe,variant:"outline",size:"sm",className:" cursor-pointer",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx(u,{children:"Select Course to Edit"}),e.jsxs(V,{value:(d==null?void 0:d.toString())||"",onValueChange:pe,children:[e.jsx(z,{children:e.jsx(P,{placeholder:"Choose a course"})}),e.jsx(Y,{children:N.map(s=>e.jsxs(f,{value:s.id.toString(),children:[s.code," - ",s.name]},s.id))})]})]}),$&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-300 p-3 dark:bg-green-900/20 dark:border-green-700/80 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["You have unsaved changes.",a.toAdd.length>0&&` ${a.toAdd.length} subject(s) to add.`,a.toRemove.length>0&&` ${a.toRemove.length} subject(s) to remove.`]})}),d?e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(S,{children:[e.jsxs(w,{children:[e.jsx(A,{className:"text-lg",children:"Available Subjects"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Subjects not assigned to this course"})]}),e.jsx(k,{children:e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:G().length>0?G().map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.code," • Year ",s.yearLevel," • Semester ",s.semester]})]}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>ne(s.id),className:" cursor-pointer",children:e.jsx(Q,{className:"h-4 w-4"})})]},s.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"All subjects are already assigned to this course."})})})]}),e.jsxs(S,{children:[e.jsxs(w,{children:[e.jsx(A,{className:"text-lg",children:"Current Curriculum"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Subjects assigned to this course"})]}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:X().length>0?X().map(s=>{const r=a.toAdd.includes(s.id),l=a.toRemove.includes(s.pivotId);return e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded ${r?"border-green-300 bg-green-50 border dark:bg-green-900/20 dark:border-green-700/80":l?"border-red-300 bg-red-50 opacity-50":""}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm ",children:s.title}),e.jsxs("p",{className:"text-xs ",children:[s.code," • Year ",s.yearLevel," • Semester ",s.semester,r&&e.jsx("span",{className:"text-green-600 ml-2",children:"(New)"}),l&&e.jsx("span",{className:"text-red-600 ml-2",children:"(To be removed)"})]})]}),e.jsx(n,{size:"sm",variant:"outline",className:" cursor-pointer",onClick:()=>{ue(s)},disabled:l,children:e.jsx(Pe,{className:"h-4 w-4"})})]},`${s.id}-${s.pivotId}`)}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No subjects assigned to this course yet."})})})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(W,{className:"h-24 w-24 text-muted-foreground"}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:"No course selected"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a course from the dropdown to manage its curriculum"})]})]})]})]})})]})]}),e.jsx(Z,{open:te,onOpenChange:q,id:ge,title:`Delete ${m==null?void 0:m.name}`,routeLink:"admin.deleteCourse",description:"This will permanently delete the course",toastMessage:`Course "${m==null?void 0:m.name}" deleted successfully`,buttonTitle:"Confirm",type:"delete",additionalInfo:[`Course "${m==null?void 0:m.name}" will be deleted`,"All of the data associated with this course will also be deleted","You can re-create the course if needed"]}),e.jsx(Z,{open:ae,onOpenChange:K,id:oe,title:`Remove ${o==null?void 0:o.title}`,routeLink:"admin.removeSubject",description:"This will permanently remove the subject from this course",toastMessage:"Removal complete",buttonTitle:"Confirm",type:"remove",additionalInfo:[`Subject "${o==null?void 0:o.title}" will be remove from this course`,"You can re-add the subject to this course later if needed"]}),e.jsx(Me,{open:ye,onOpenChange:E,children:e.jsxs(Te,{className:"sm:max-w-[500px]",children:[e.jsx(Ee,{children:e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),"Edit Course"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-code",children:"Code"}),e.jsx(I,{id:"courseCode",value:(t==null?void 0:t.code)||"",onChange:s=>g({...t,code:s.target.value}),placeholder:"Enter course code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-name",children:"Name"}),e.jsx(I,{id:"courseName",value:(t==null?void 0:t.name)||"",onChange:s=>g({...t,name:s.target.value}),placeholder:"Enter course name"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-description",children:"Description"}),e.jsx(J,{id:"courseDescription",value:(t==null?void 0:t.description)||"",onChange:s=>g({...t,description:s.target.value}),placeholder:"Enter course description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-status",children:"Status"}),e.jsxs(V,{value:(t==null?void 0:t.isActive)===1?"active":"inactive",onValueChange:s=>{g({...t,isActive:s==="active"?1:0})},children:[e.jsx(z,{children:e.jsx(P,{placeholder:"Select status"})}),e.jsxs(Y,{children:[e.jsx(f,{value:"active",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Active"]})}),e.jsx(f,{value:"inactive",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full"}),"Inactive"]})})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>E(!1),className:" cursor-pointer",children:"Cancel"}),e.jsx(n,{onClick:()=>be(t.id),className:" cursor-pointer",children:"Save Changes"})]})]})})]})]})}export{bs as default};
