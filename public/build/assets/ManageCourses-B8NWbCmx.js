import{K as fe,r as l,m as Ne,j as e,L as be,S as x,t as $}from"./app-Dg84d6fb.js";import{A as Ce}from"./app-layout-DbnVHMmT.js";import{C as f,a as N,b,c as C,B as L}from"./badge-CIbo3TBm.js";import{B as d}from"./button-CCMnkL0Z.js";import{I as y}from"./input-L_WL-J02.js";import{L as h}from"./label-BIzBIdCq.js";import{T as _}from"./textarea-BofmPSvp.js";import{S as q,a as K,b as U,c as X,d as B}from"./select-DiX0Frmw.js";import{T as ye,a as Se,b as z,c as F}from"./tabs-o9mNndV0.js";import{A as Ae,a as we,b as ke,c as Ie}from"./alert-dialog-DTnSPhxN.js";import{D as G}from"./delete-modal-CmQURamh.js";import{S as Re}from"./search-cfURqkyw.js";import{P as J}from"./plus-C8tYn3d7.js";import{S as Te}from"./square-pen-2K3b_iy5.js";import{T as Ee}from"./trash-2-BNwSeIXS.js";import{c as Q}from"./createLucideIcon-BiCGBh9O.js";import{X as De}from"./x-DmkD1HkF.js";import{B as Me}from"./book-C0mJ2NqT.js";import"./user-menu-content-CNiipdoX.js";import"./index-D9Qf7InJ.js";import"./index-BAowfLDo.js";import"./app-logo-icon-ByEGs7py.js";import"./users-DOmuk_5F.js";import"./graduation-cap-7lI1D_yU.js";import"./mail-CpbfIAwh.js";import"./index-BxU5CMXm.js";import"./chevron-down-DAZYoLuu.js";import"./check-Bo5VHAp4.js";import"./unlink-DeEZ-3Yt.js";import"./triangle-alert-Dzf1c8sf.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M5 12h14",key:"1ays0h"}]],Le=Q("Minus",$e);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ze=Q("Save",Be),Fe=[{title:"Manage Courses",href:"admin/manageCourses"}];function vs({courses:S,allSubjects:T}){const{auth:v}=fe().props,[W,A]=l.useState("view-courses"),[c,E]=l.useState(null),[Oe,Ve]=l.useState(null),[Z,O]=l.useState(!1),[ee,V]=l.useState(!1),[t,w]=l.useState({toAdd:[],toRemove:[]}),[D,k]=l.useState(!1),{data:p,setData:M,post:se,processing:Y,errors:I,reset:ae}=Ne({code:"",name:"",description:""}),H=()=>{if(!c)return[];const s=S.find(o=>o.id===c);let i=((s==null?void 0:s.subjects)||[]).filter(o=>!t.toRemove.includes(o.pivotId));const n=T.filter(o=>t.toAdd.includes(o.id)).map(o=>({...o,pivotId:0}));return i=[...i,...n],i},P=()=>{var i;if(!c)return[];const s=S.find(n=>n.id===c);if(!s)return T;const r=((i=s.subjects)==null?void 0:i.map(n=>n.id))||[];return T.filter(n=>!r.includes(n.id)&&!t.toAdd.includes(n.id)&&!t.toRemove.includes(n.id))},te=s=>{w(r=>({...r,toAdd:[...r.toAdd,s]})),k(!0)},[m,re]=l.useState(null),[ie,le]=l.useState(0),ne=async s=>{V(!0),re(s),le(s.pivotId),console.log(s.pivotId),x.post(route("admin.addActivity"),{type:"remove",user:v.user.name,action:"Remove a subject",details:`${m==null?void 0:m.title}`},{})},de=()=>{if(!c||t.toAdd.length===0&&t.toRemove.length===0){console.log("No course selected or no changes to save");return}const s={course_id:c,toAdd:t.toAdd,toRemove:t.toRemove};x.post(route("admin.assignSubjects"),s,{onSuccess:()=>{x.post(route("admin.addActivity"),{type:"assign",user:v.user.name,action:"Assign subjects",details:`${t==null?void 0:t.toAdd}`},{}),w({toAdd:[],toRemove:[]}),k(!1),console.log("Curriculum updated successfully!"),$.success("Curriculum updated successfully!")},onError:r=>{console.error("Error saving curriculum changes:",r)}})},ce=()=>{w({toAdd:[],toRemove:[]}),k(!1)},oe=s=>{D?confirm("You have unsaved changes. Do you want to discard them?")&&(w({toAdd:[],toRemove:[]}),k(!1),E(Number.parseInt(s))):E(Number.parseInt(s))},me=async s=>{s.preventDefault(),se(route("admin.addCourse"),{onSuccess:()=>{x.post(route("admin.addActivity"),{type:"create",user:v.user.name,action:"Create new course",details:`${p==null?void 0:p.name}`},{}),ae(),$.success("New course has been added.")},onError:r=>{console.error("Error occured",r)}})},[u,ue]=l.useState(null),[he,xe]=l.useState(0),pe=async s=>{O(!0),ue(s),xe(s.id),x.post(route("admin.addActivity"),{type:"delete",user:v.user.name,action:"Delete a course",details:`${s==null?void 0:s.name}`},{}),console.log(s)},[a,j]=l.useState(null),[je,R]=l.useState(!1),ve=async s=>{j(s),R(!0)},ge=async s=>{x.put(route("admin.updateCourse",s),{code:a==null?void 0:a.code,name:a==null?void 0:a.name,description:a==null?void 0:a.description,isActive:a==null?void 0:a.isActive},{onSuccess:()=>{j(null),$("Edit successfully"),R(!1),x.post(route("admin.addActivity"),{type:"edit",user:v.user.name,action:"Updated course",details:`${a==null?void 0:a.name} modified`},{})},onError:r=>{console.error("Error on editing course",r)}})};return e.jsxs(Ce,{breadcrumbs:Fe,children:[e.jsx(be,{title:"Manage Students"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl overflow-x-auto p-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Courses & Curriculum"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage degree programs and their curriculum. Create courses first, then add subjects to build the curriculum."})]}),e.jsxs(ye,{value:W,onValueChange:A,className:"space-y-4",children:[e.jsxs(Se,{className:"grid w-full grid-cols-3 ",children:[e.jsx(z,{value:"view-courses",className:"cursor-pointer",children:"View Courses"}),e.jsx(z,{value:"add-course",className:"cursor-pointer",children:"Add New Course"}),e.jsx(z,{value:"manage-curriculum",className:"cursor-pointer",children:"Manage Curriculum"})]}),e.jsx(F,{value:"view-courses",className:"space-y-4",children:e.jsxs(f,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{children:"All Degree Programs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(y,{placeholder:"Search courses...",className:"pl-8 w-64"})]}),e.jsxs(d,{onClick:()=>A("add-course"),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add Course"]})]})]})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-4v grid grid-cols-2 gap-4",children:S.map(s=>{var r,i,n,o;return e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex-1 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx(L,{variant:"outline",children:s.code}),e.jsxs(L,{variant:"secondary",children:[((r=s.subjects)==null?void 0:r.length)||0," subjects"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:s.isActive===1?"default":"secondary",children:s.isActive===1?"active":"inactive"}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>ve(s),children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{pe(s)},children:e.jsx(Ee,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2",children:["Curriculum (",((i=s.subjects)==null?void 0:i.length)||0," subjects)"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:(n=s.subjects)==null?void 0:n.slice(0,4).map(g=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-secondary rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:g.code}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:g.title})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Y",g.yearLevel,"S",g.semester]})]},g.code))}),s.subjects&&s.subjects.length>4&&e.jsxs(d,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>{E(s.id),A("manage-curriculum")},children:["View all ",(o=s.subjects)==null?void 0:o.length," subjects →"]})]})]})})},s.id)})})})]})}),e.jsx(F,{value:"add-course",className:"space-y-4",children:e.jsxs(f,{children:[e.jsx(N,{children:e.jsx(b,{children:"Add New Course Program"})}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"code",children:"Course Code"}),e.jsx(y,{id:"code",value:p.code,onChange:s=>M("code",s.target.value),placeholder:"e.g. BSIS, BSCS"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"name",children:"Course Name"}),e.jsx(y,{id:"name",value:p.name,onChange:s=>M("name",s.target.value),placeholder:"e.g. Bachelor of Science in Information Systems"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"description",children:"Description"}),e.jsx(_,{id:"description",value:p.description,onChange:s=>M("description",s.target.value),placeholder:"Enter course description",rows:3})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(d,{onClick:me,children:"Add Course"}),e.jsx(d,{variant:"outline",onClick:()=>A("view-courses"),children:"Cancel"}),I.code&&e.jsx("p",{className:"text-sm font-medium text-destructive",children:I.code}),(I.code||I.name)&&e.jsx("p",{className:"text-sm font-medium text-destructive",children:"Complete all fields"})]})]})})]})}),e.jsx(F,{value:"manage-curriculum",className:"space-y-4",children:e.jsxs(f,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{children:"Manage Course Curriculum"}),D&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:de,disabled:Y||t.toAdd.length===0,size:"sm",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),Y?"Saving...":"Save Changes"]}),e.jsxs(d,{onClick:ce,variant:"outline",size:"sm",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]})}),e.jsxs(C,{children:[e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx(h,{children:"Select Course to Edit"}),e.jsxs(q,{value:(c==null?void 0:c.toString())||"",onValueChange:oe,children:[e.jsx(K,{children:e.jsx(U,{placeholder:"Choose a course"})}),e.jsx(X,{children:S.map(s=>e.jsxs(B,{value:s.id.toString(),children:[s.code," - ",s.name]},s.id))})]})]}),D&&e.jsx("div",{className:"mb-4 bg-green-50 border border-green-300 p-3 dark:bg-green-900/20 dark:border-green-700/80 rounded-lg",children:e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["You have unsaved changes.",t.toAdd.length>0&&` ${t.toAdd.length} subject(s) to add.`,t.toRemove.length>0&&` ${t.toRemove.length} subject(s) to remove.`]})}),c&&e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(f,{children:[e.jsxs(N,{children:[e.jsx(b,{className:"text-lg",children:"Available Subjects"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Subjects not assigned to this course"})]}),e.jsx(C,{children:e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:P().length>0?P().map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.code," • Year ",s.yearLevel," • Semester ",s.semester]})]}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>te(s.id),children:e.jsx(J,{className:"h-4 w-4"})})]},s.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"All subjects are already assigned to this course."})})})]}),e.jsxs(f,{children:[e.jsxs(N,{children:[e.jsx(b,{className:"text-lg",children:"Current Curriculum"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Subjects assigned to this course"})]}),e.jsx(C,{children:e.jsx("div",{className:"space-y-4",children:H().length>0?H().map(s=>{const r=t.toAdd.includes(s.id),i=t.toRemove.includes(s.pivotId);return e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded ${r?"border-green-300 bg-green-50 border dark:bg-green-900/20 dark:border-green-700/80":i?"border-red-300 bg-red-50 opacity-50":""}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm ",children:s.title}),e.jsxs("p",{className:"text-xs ",children:[s.code," • Year ",s.yearLevel," • Semester ",s.semester,r&&e.jsx("span",{className:"text-green-600 ml-2",children:"(New)"}),i&&e.jsx("span",{className:"text-red-600 ml-2",children:"(To be removed)"})]})]}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>{ne(s)},disabled:i,children:e.jsx(Le,{className:"h-4 w-4"})})]},`${s.id}-${s.pivotId}`)}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No subjects assigned to this course yet."})})})]})]})]})]})})]})]}),e.jsx(G,{open:Z,onOpenChange:O,id:he,title:`Delete ${u==null?void 0:u.name}`,routeLink:"admin.deleteCourse",description:"This will permanently delete the course",toastMessage:`Course "${u==null?void 0:u.name}" deleted successfully`,buttonTitle:"Confirm",type:"delete",additionalInfo:[`Course "${u==null?void 0:u.name}" will be deleted`,"All of the data associated with this course will also be deleted","You can re-create the course if needed"]}),e.jsx(G,{open:ee,onOpenChange:V,id:ie,title:`Remove ${m==null?void 0:m.title}`,routeLink:"admin.removeSubject",description:"This will permanently remove the subject from this course",toastMessage:"Removal complete",buttonTitle:"Confirm",type:"remove",additionalInfo:[`Subject "${m==null?void 0:m.title}" will be remove from this course`,"You can re-add the subject to this course later if needed"]}),e.jsx(Ae,{open:je,onOpenChange:R,children:e.jsxs(we,{className:"sm:max-w-[500px]",children:[e.jsx(ke,{children:e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5"}),"Edit Course"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-code",children:"Code"}),e.jsx(y,{id:"courseCode",value:(a==null?void 0:a.code)||"",onChange:s=>j({...a,code:s.target.value}),placeholder:"Enter course code"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-name",children:"Name"}),e.jsx(y,{id:"courseName",value:(a==null?void 0:a.name)||"",onChange:s=>j({...a,name:s.target.value}),placeholder:"Enter course name"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-description",children:"Description"}),e.jsx(_,{id:"courseDescription",value:(a==null?void 0:a.description)||"",onChange:s=>j({...a,description:s.target.value}),placeholder:"Enter course description"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-status",children:"Status"}),e.jsxs(q,{value:(a==null?void 0:a.isActive)===1?"active":"inactive",onValueChange:s=>{j({...a,isActive:s==="active"?1:0})},children:[e.jsx(K,{children:e.jsx(U,{placeholder:"Select status"})}),e.jsxs(X,{children:[e.jsx(B,{value:"active",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Active"]})}),e.jsx(B,{value:"inactive",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full"}),"Inactive"]})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>R(!1),children:"Cancel"}),e.jsx(d,{onClick:()=>ge(a.id),children:"Save Changes"})]})]})})]})]})}export{vs as default};
